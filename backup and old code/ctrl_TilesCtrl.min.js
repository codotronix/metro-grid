!function(){angular.module("barickOSApp").controller("tilesCtrl",["$scope","$http","$rootScope","tileManager",function(e,t,i,l){var o;t.get("data/TM.json").then(function(t){var i=t.data;e.TM=l.tilify(i),o=l.getGrids()},function(e){console.log(e)}),e.getClearSpaceDivPosition=l.getClearSpaceDivPosition,e.$on("tileMovementEnd",function(){e.TM=l.reTilify(e.TM)}),e.tileClicked=function(e,t){return i.flags.tileMovementAllowed||i.flags.tileResizingAllowed?void e.preventDefault():void 0};var n=0;e.tileTouchStart=function(e){return i.flags.tileMovementAllowed||i.flags.tileResizingAllowed?(e.preventDefault(),void(n=0)):void(n=(new Date).getTime())},e.tileTouchEnd=function(e,t){var l=(new Date).getTime(),o=l-n;return console.log("timeDiff="+o),n=0,i.flags.tileMovementAllowed||i.flags.tileResizingAllowed?void e.preventDefault():(o>500&&(console.log("here"),window.location.href=t),void(n=0))};var d=["small","medium","rectangle","big"];e.nextSize=function(t){var i=e.TM,o=i.tiles[t].size,n=(d.indexOf(o)+1)%d.length,a=d[n];i.tiles[t].size=a,e.TM=l.reTilify(i)};var a=0,r=0;e.dto=null,e.sto=null;var g=[];e.dragStart=function(t,l){!i.flags.tileOpInProg&&i.flags.tileMovementAllowed&&(i.flags.tileOpInProg=!0,t.stopPropagation(),t.pageX=t.pageX||t.originalEvent.changedTouches[0].pageX,t.pageY=t.pageY||t.originalEvent.changedTouches[0].pageY,a=t.pageX,r=t.pageY,e.dto=e.TM.tiles[l],e.dto.zIndex=1100)},e.dragEnd=function(t){if(i.flags.tileOpInProg&&i.flags.tileMovementAllowed&&(t.stopPropagation(),null!=e.dto)){if(null!=e.sto){if(n=e.TM.tileOrder.indexOf(e.dto.id),g=[],1==Math.abs(e.TM.tileOrder.indexOf(e.dto.id)-e.TM.tileOrder.indexOf(e.sto.id))){g=e.TM.tileOrder;var n=e.TM.tileOrder.indexOf(e.sto.id),d=e.TM.tileOrder.indexOf(e.dto.id);g[n]=e.dto.id,g[d]=e.sto.id}else for(var a in e.TM.tileOrder)e.TM.tileOrder[a]!=e.dto.id&&(e.TM.tileOrder[a]==e.sto.id?(g.push(e.dto.id),g.push(e.sto.id)):g.push(e.TM.tileOrder[a]));var r=e.TM;r.tileOrder=g,e.TM=l.reTilify(r)}else dto.top=o[dto.gridId].top,dto.left=o[dto.gridId].left;e.dto=null,e.sto=null,i.flags.tileOpInProg=!1}},e.dragMove=function(t){if(i.flags.tileOpInProg&&i.flags.tileMovementAllowed){t.stopPropagation(),t.preventDefault(),t.pageX=t.pageX||t.originalEvent.changedTouches[0].pageX,t.pageY=t.pageY||t.originalEvent.changedTouches[0].pageY;var l=t.pageX-a,o=t.pageY-r;a=t.pageX,r=t.pageY;var n=e.dto.left+l,d=e.dto.top+o;for(var g in e.TM.tiles){var s=e.TM.tiles[g];if(e.dto.id!=s.id&&Math.abs(s.left-e.dto.left)<s.width/2&&Math.abs(s.top-e.dto.top)<s.height/2){e.sto=s;break}}e.dto.top=d,e.dto.left=n}},e.dragEnd=function(t){if(i.flags.tileOpInProg&&i.flags.tileMovementAllowed&&null!=e.dto&&null!=e.sto){t.stopPropagation();var o=[];for(var n in e.TM.tileOrder)e.TM.tileOrder[n]!=e.dto.id&&(e.TM.tileOrder[n]==e.sto.id?(o.push(e.dto.id),o.push(e.sto.id)):o.push(e.TM.tileOrder[n]));e.dto=null,e.sto=null;var d=e.TM;d.tileOrder=o,e.TM=l.reTilify(d),i.flags.tileOpInProg=!1}}}])}();