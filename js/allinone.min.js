!function(){angular.module("barickOSApp",["ngRoute","ngTouch"]).directive("tileAnimator",["$timeout","$rootScope",function(e,t){return{restrict:"E",controller:["$scope",function(i){function l(){t.flags.tileMovementAllowed||t.flags.tileResizingAllowed||(i.currImgIndex=(i.currImgIndex+1)%i.tile.liveImgUrls.length,i.AnimateImgClass=n[Math.floor(Math.random()*n.length)]),i.tile.liveImgUrls.length>1&&e(l,a)}function o(){t.flags.tileMovementAllowed||t.flags.tileResizingAllowed||(i.currTxtIndex=(i.currTxtIndex+1)%i.tile.liveTxts.length,i.AnimateTxtClass=r[Math.floor(Math.random()*r.length)]),i.tile.liveTxts.length>1&&e(o,d)}i.currImgIndex=0,i.currTxtIndex=0,i.AnimateImgClass="bounce",i.AnimateTxtClass="fadeIn";var n=["slideInDown","slideInLeft","slideInRight","slideInUp","rotateIn","rollIn","zoomIn"],r=["fadeIn"];if(void 0!=i.tile.liveImgUrls){var a=2500+Math.round(Math.random()*(5e3/i.tile.liveImgUrls.length));l()}if(void 0!=i.tile.liveTxts){var d=2500+Math.round(Math.random()*(5e3/i.tile.liveTxts.length));o()}}],templateUrl:"partials/tileAnimator.html"}}]).service("tileManager",function(){function e(){var e=17,t=angular.element(".tiles-container").width()-e;c="xs";f=12,u=Math.floor(t/f),t>=1200?(c="lg",f=16,u=Math.floor(t/f)):t>=992?c="md":t>=768?c="sm":(c="xs",f=4,u=Math.floor((t+e)/f)),p=2*u,v=2*p}function t(){if("xs"==c)for(var e in s)s[e].size="big"==s[e].size?"medium":s[e].size}function i(){fillCapacity=0;for(var e in s)"small"==s[e].size?fillCapacity+=1:"medium"==s[e].size?fillCapacity+=4:"rectangle"==s[e].size?fillCapacity+=8:"big"==s[e].size&&(fillCapacity+=16);var t=f*Math.ceil(fillCapacity/f)*2;g={};for(var i=0,l=1,e=1;t>=e;e++){i++,i>f&&(i=1,l++);var o={};o.indX=i,o.indY=l,o.id=i+"x"+l,o.occupiedBy="none",o.top=(l-1)*u,o.left=(i-1)*u,o.type="",g[o.id]=o}}function l(){for(var e in g)g[e].occupiedBy="none",g[e].type=""}function o(){h=0;var e="";for(var t in d)e=d[t],gridId=n(s[e]),s[e].gridId=gridId,s[e].width="small"==s[e].size?u:"medium"==s[e].size?p:v,s[e].height="small"==s[e].size?u:"big"==s[e].size?v:p,s[e].bgColor=s[e].bgColor||m[Math.floor(Math.random()*m.length)],s[e].top=g[gridId].top,s[e].left=g[gridId].left,h=s[e].top+s[e].height>h?s[e].top+s[e].height:h}function n(e){for(var t in g)if("none"==g[t].occupiedBy){if("small"==e.size)return g[t].occupiedBy=e.id,g[t].type="startGrid",t;if(r(g[t].id,e.size))return a(g[t].id,e.size,e.id),g[t].type="startGrid",t}console.log("No Grid Avaialble for Tile id="+e.id)}function r(e,t){for(var i="medium"==t?2:4,l="big"==t?4:2,o=g[e].indX,n=g[e].indY,r=o+(i-1),a=n+(l-1),d="",s=!1,f=o;r>=f;f++){for(var c=n;a>=c;c++)if(d=f+"x"+c,void 0==g[d]||void 0==typeof g[d]||"none"!=g[d].occupiedBy){s=!0;break}if(s)break}return!s}function a(e,t,i){for(var l="medium"==t?2:4,o="big"==t?4:2,n=g[e].indX,r=g[e].indY,a=n+(l-1),d=r+(o-1),s="",f=n;a>=f;f++)for(var c=r;d>=c;c++)s=f+"x"+c,g[s].occupiedBy=i}var d=[],s={},g={},f=0,c="xs",u=0,p=0,v=0,h=200,m=["#632F00","#B01E00","#C1004F","#4617B4","#008287","#199900","#00C13F","#FF2E12","#FF1D77","#AA40FF","#1FAEFF","#000","#00A3A3","#FE7C22"];this.tilify=function(l){return s=l.tiles,d=l.tileOrder,e(),t(),i(),o(),l.tiles=s,l.tileOrder=d,l},this.reTilify=function(e){return s=e.tiles,d=e.tileOrder,console.log("tileOrder: "+JSON.stringify(d)),l(),o(),e.tiles=s,e.tileOrder=d,e},this.getClearSpaceDivPosition=function(){return h},this.getGrids=function(){return g}}).controller("mainCtrl",["$scope","$rootScope",function(e,t){t.flags={},t.flags.tileOpInProg=!1,t.flags.tileResizingAllowed=!1,t.flags.tileMovementAllowed=!1,e.toggleTileResize=function(e){e.stopPropagation(),t.flags.tileResizingAllowed=!t.flags.tileResizingAllowed,t.flags.tileMovementAllowed=!1},e.toggleTileMove=function(e){e.stopPropagation(),t.flags.tileMovementAllowed&&t.$broadcast("tileMovementEnd"),t.flags.tileMovementAllowed=!t.flags.tileMovementAllowed,t.flags.tileResizingAllowed=!1}}]).controller("tilesCtrl",["$scope","$http","$rootScope","tileManager",function(e,t,i,l){var o;t.get("data/TM.json").then(function(t){var i=t.data;e.TM=l.tilify(i),o=l.getGrids()},function(e){console.log(e)}),e.getClearSpaceDivPosition=l.getClearSpaceDivPosition,e.$on("tileMovementEnd",function(){e.TM=l.reTilify(e.TM)}),e.tileClicked=function(e,t){return i.flags.tileMovementAllowed||i.flags.tileResizingAllowed?void e.preventDefault():void 0};var n=0;e.tileTouchStart=function(e){return i.flags.tileMovementAllowed||i.flags.tileResizingAllowed?(e.preventDefault(),void(n=0)):void(n=(new Date).getTime())},e.tileTouchEnd=function(e,t){var l=(new Date).getTime(),o=l-n;return console.log("timeDiff="+o),n=0,i.flags.tileMovementAllowed||i.flags.tileResizingAllowed?void e.preventDefault():(o>500&&(console.log("here"),window.location.href=t),void(n=0))};var r=["small","medium","rectangle","big"];e.nextSize=function(t){var i=e.TM,o=i.tiles[t].size,n=(r.indexOf(o)+1)%r.length,a=r[n];i.tiles[t].size=a,e.TM=l.reTilify(i)};var a=0,d=0;e.dto=null,e.sto=null;var s=[];e.dragStart=function(t,l){!i.flags.tileOpInProg&&i.flags.tileMovementAllowed&&(i.flags.tileOpInProg=!0,t.stopPropagation(),t.pageX=t.pageX||t.originalEvent.changedTouches[0].pageX,t.pageY=t.pageY||t.originalEvent.changedTouches[0].pageY,a=t.pageX,d=t.pageY,e.dto=e.TM.tiles[l],e.dto.zIndex=1100)},e.dragEnd=function(t){if(i.flags.tileOpInProg&&i.flags.tileMovementAllowed&&(t.stopPropagation(),null!=e.dto)){if(null!=e.sto){if(n=e.TM.tileOrder.indexOf(e.dto.id),s=[],1==Math.abs(e.TM.tileOrder.indexOf(e.dto.id)-e.TM.tileOrder.indexOf(e.sto.id))){s=e.TM.tileOrder;var n=e.TM.tileOrder.indexOf(e.sto.id),r=e.TM.tileOrder.indexOf(e.dto.id);s[n]=e.dto.id,s[r]=e.sto.id}else for(var a in e.TM.tileOrder)e.TM.tileOrder[a]!=e.dto.id&&(e.TM.tileOrder[a]==e.sto.id?(s.push(e.dto.id),s.push(e.sto.id)):s.push(e.TM.tileOrder[a]));var d=e.TM;d.tileOrder=s,e.TM=l.reTilify(d)}else dto.top=o[dto.gridId].top,dto.left=o[dto.gridId].left;e.dto=null,e.sto=null,i.flags.tileOpInProg=!1}},e.dragMove=function(t){if(i.flags.tileOpInProg&&i.flags.tileMovementAllowed){t.stopPropagation(),t.preventDefault(),t.pageX=t.pageX||t.originalEvent.changedTouches[0].pageX,t.pageY=t.pageY||t.originalEvent.changedTouches[0].pageY;var l=t.pageX-a,o=t.pageY-d;a=t.pageX,d=t.pageY;var n=e.dto.left+l,r=e.dto.top+o;for(var s in e.TM.tiles){var g=e.TM.tiles[s];if(e.dto.id!=g.id&&Math.abs(g.left-e.dto.left)<g.width/2&&Math.abs(g.top-e.dto.top)<g.height/2){e.sto=g;break}}e.dto.top=r,e.dto.left=n}},e.dragEnd=function(t){if(i.flags.tileOpInProg&&i.flags.tileMovementAllowed&&null!=e.dto&&null!=e.sto){t.stopPropagation();var o=[];for(var n in e.TM.tileOrder)e.TM.tileOrder[n]!=e.dto.id&&(e.TM.tileOrder[n]==e.sto.id?(o.push(e.dto.id),o.push(e.sto.id)):o.push(e.TM.tileOrder[n]));e.dto=null,e.sto=null;var r=e.TM;r.tileOrder=o,e.TM=l.reTilify(r),i.flags.tileOpInProg=!1}}}]).config(["$routeProvider","$locationProvider",function(e,t){t.html5Mode(!1),t.hashPrefix("!"),e.when("/desktop",{templateUrl:"partials/tiles.html",controller:"tilesCtrl"}).when("/",{redirectTo:"/desktop"}).otherwise({redirectTo:"/"})}])}();